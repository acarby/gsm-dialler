name: CI Validation

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Validate file structure
      run: |
        echo "üîç Validating project structure..."
        test -f deploy/install.sh || (echo "‚ùå Missing deploy/install.sh" && exit 1)
        test -f README.md || (echo "‚ùå Missing README.md" && exit 1)
        test -f gpio_trigger.py || (echo "‚ùå Missing gpio_trigger.py" && exit 1)
        test -f test_call.py || (echo "‚ùå Missing test_call.py" && exit 1)
        test -f test_sms.py || (echo "‚ùå Missing test_sms.py" && exit 1)
        echo "‚úÖ All required files present"
    
    - name: Check shell script syntax
      run: |
        if command -v shellcheck &> /dev/null; then
          shellcheck deploy/*.sh || echo "‚ö†Ô∏è ShellCheck warnings (non-fatal)"
        else
          echo "‚ÑπÔ∏è ShellCheck not available, skipping syntax check"
        fi
    
    - name: Validate Python syntax
      run: |
        python3 -m py_compile *.py 2>&1 || echo "‚ö†Ô∏è Python syntax check (non-fatal)"
        echo "‚úÖ Python files validated"
    
    - name: Check for sensitive data
      run: |
        echo "üîí Checking for sensitive data..."
        if grep -r "password.*=" --include="*.py" --include="*.php" . | grep -v "#.*password" | grep -v "password.*hash"; then
          echo "‚ö†Ô∏è Potential password found in code"
        fi
        if grep -r "api.*key" --include="*.py" --include="*.php" -i .; then
          echo "‚ö†Ô∏è Potential API key found"
        fi
        echo "‚úÖ Security check complete"

